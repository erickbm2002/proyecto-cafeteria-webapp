<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{layout/public :: layout_public(~{::article}, 'Checkout', null)}"
>
  <body>
    <article>
      <!-- Page Header -->
      <section class="page-header">
        <div class="container">
          <h1 class="page-title">
            <i class="bi bi-credit-card me-2"></i>Finalizar Compra
          </h1>
          <p class="page-subtitle">Completa tu pedido de forma segura</p>
        </div>
      </section>

      <section class="container py-5">
        <!-- Alertas -->
        <div th:if="${mensaje}" class="alert alert-dismissible fade show mb-4" 
             th:classappend="${'alert-' + tipo}" role="alert">
          <i class="bi" th:classappend="${tipo == 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill'}"></i>
          <span th:text="${mensaje}"></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
          <i class="bi bi-exclamation-triangle-fill"></i>
          <span th:text="${error}"></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <form th:action="@{/checkout/procesar}" method="post" id="checkoutForm">
          <div class="row">
            <!-- Columna Izquierda: Información de Envío y Pago -->
            <div class="col-lg-7 mb-4">
              
              <!-- Información del Cliente -->
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-coffee text-white">
                  <h5 class="mb-0">
                    <i class="bi bi-person-fill me-2"></i>Información del Cliente
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">
                        <i class="bi bi-person me-2"></i>Nombre
                      </label>
                      <input type="text" class="form-control" 
                             th:value="${usuario.nombre}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">
                        <i class="bi bi-envelope me-2"></i>Correo
                      </label>
                      <input type="email" class="form-control" 
                             th:value="${usuario.correo}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">
                        <i class="bi bi-telephone me-2"></i>Teléfono
                      </label>
                      <input type="tel" class="form-control" 
                             th:value="${usuario.telefono}" readonly>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Dirección de Entrega -->
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-coffee text-white">
                  <h5 class="mb-0">
                    <i class="bi bi-geo-alt-fill me-2"></i>Dirección de Entrega
                  </h5>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label for="direccionEnvio" class="form-label">
                      Dirección Completa *
                    </label>
                    <textarea 
                      class="form-control" 
                      id="direccionEnvio"
                      name="direccionEnvio"
                      rows="3"
                      required
                      placeholder="Calle, número, ciudad, código postal..."
                      th:text="${usuario.direccion}"
                    ></textarea>
                  </div>

                  <div class="mb-3">
                    <label for="notasEspeciales" class="form-label">
                      Notas Especiales (Opcional)
                    </label>
                    <textarea 
                      class="form-control" 
                      id="notasEspeciales"
                      name="notasEspeciales"
                      rows="2"
                      placeholder="Instrucciones de entrega, alergias, etc."
                    ></textarea>
                  </div>
                </div>
              </div>

              <!-- Método de Pago -->
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-coffee text-white">
                  <h5 class="mb-0">
                    <i class="bi bi-credit-card-fill me-2"></i>Método de Pago
                  </h5>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Selecciona el método de pago *</label>
                    
                    <!-- Tarjeta -->
                    <div class="form-check mb-3 p-3 border rounded">
                      <input 
                        class="form-check-input" 
                        type="radio" 
                        name="metodoPago" 
                        id="tarjeta"
                        value="Tarjeta"
                        checked
                        required
                      />
                      <label class="form-check-label" for="tarjeta">
                        <i class="bi bi-credit-card me-2"></i>
                        <strong>Tarjeta de Crédito/Débito</strong>
                        <br>
                        <small class="text-muted">Visa, Mastercard, American Express</small>
                      </label>
                    </div>

                    <!-- PayPal -->
                    <div class="form-check mb-3 p-3 border rounded">
                      <input 
                        class="form-check-input" 
                        type="radio" 
                        name="metodoPago" 
                        id="paypal"
                        value="PayPal"
                      />
                      <label class="form-check-label" for="paypal">
                        <i class="bi bi-paypal me-2"></i>
                        <strong>PayPal</strong>
                        <br>
                        <small class="text-muted">Paga de forma segura con tu cuenta PayPal</small>
                      </label>
                    </div>

                    <!-- Efectivo -->
                    <div class="form-check mb-3 p-3 border rounded">
                      <input 
                        class="form-check-input" 
                        type="radio" 
                        name="metodoPago" 
                        id="efectivo"
                        value="Efectivo"
                      />
                      <label class="form-check-label" for="efectivo">
                        <i class="bi bi-cash-coin me-2"></i>
                        <strong>Efectivo contra entrega</strong>
                        <br>
                        <small class="text-muted">Paga en efectivo al recibir tu pedido</small>
                      </label>
                    </div>
                  </div>

                  <!-- Información de tarjeta (se muestra solo si selecciona tarjeta) -->
                  <div id="infoTarjeta" class="mt-4">
                    <div class="alert alert-info">
                      <i class="bi bi-info-circle me-2"></i>
                      <small>
                        <strong>Nota:</strong> Este es un sistema de demostración. 
                        No se procesarán pagos reales. En producción, aquí iría la integración 
                        con una pasarela de pago real (Stripe, PayPal, etc.)
                      </small>
                    </div>
                    
                    <div class="row">
                      <div class="col-12 mb-3">
                        <label class="form-label">Número de Tarjeta</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="1234 5678 9012 3456"
                          maxlength="19"
                        />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Fecha de Vencimiento</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="MM/AA"
                          maxlength="5"
                        />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">CVV</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="123"
                          maxlength="4"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Columna Derecha: Resumen del Pedido -->
            <div class="col-lg-5">
              <div class="card shadow-sm border-0 sticky-top" style="top: 20px;">
                <div class="card-header bg-coffee text-white">
                  <h5 class="mb-0">
                    <i class="bi bi-receipt me-2"></i>Resumen del Pedido
                  </h5>
                </div>
                <div class="card-body">
                  <!-- Lista de productos -->
                  <div class="mb-3" style="max-height: 300px; overflow-y: auto;">
                    <div th:each="item : ${items}" class="d-flex align-items-center mb-3 pb-3 border-bottom">
                      <img 
                        th:src="@{'/img/' + ${item.nombreImagen}}" 
                        alt="Producto"
                        class="rounded me-3"
                        style="width: 50px; height: 50px; object-fit: cover;"
                      />
                      <div class="flex-grow-1">
                        <h6 class="mb-1" th:text="${item.nombre}"></h6>
                        <small class="text-muted">
                          Cantidad: <span th:text="${item.cantidad}"></span>
                        </small>
                      </div>
                      <div class="text-end">
                        <strong>₡<span th:text="${#numbers.formatDecimal(item.subtotal, 1, 2)}"></span></strong>
                      </div>
                    </div>
                  </div>

                  <hr>

                  <!-- Totales -->
                  <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <strong>₡<span th:text="${#numbers.formatDecimal(subtotal, 1, 2)}"></span></strong>
                  </div>

                  <div th:if="${ahorroTotal > 0}" class="d-flex justify-content-between mb-2 text-success">
                    <span>Descuentos:</span>
                    <strong>-₡<span th:text="${#numbers.formatDecimal(ahorroTotal, 1, 2)}"></span></strong>
                  </div>

                  <div class="d-flex justify-content-between mb-2">
                    <span>Envío:</span>
                    <strong>₡0.00</strong>
                  </div>

                  <hr>

                  <div class="d-flex justify-content-between mb-3">
                    <h5 class="mb-0">Total:</h5>
                    <h5 class="mb-0 text-coffee">
                      ₡<span th:text="${#numbers.formatDecimal(totalConDescuentos, 1, 2)}"></span>
                    </h5>
                  </div>

                  <!-- Botón de pago -->
                  <button type="submit" class="btn btn-coffee w-100 mb-3">
                    <i class="bi bi-lock-fill me-2"></i>Realizar Pedido
                  </button>

                  <!-- Seguridad -->
                  <div class="text-center">
                    <small class="text-muted">
                      <i class="bi bi-shield-check me-1"></i>
                      Pago 100% seguro y protegido
                    </small>
                  </div>
                </div>
              </div>

              <!-- Volver al carrito -->
              <div class="text-center mt-3">
                <a th:href="@{/carrito}" class="text-muted">
                  <i class="bi bi-arrow-left me-1"></i>Volver al carrito
                </a>
              </div>
            </div>
          </div>
        </form>
      </section>
    </article>


   
    
  
  </body>
</html>